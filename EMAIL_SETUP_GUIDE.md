# Email Notification Setup Guide

This guide explains how to set up email notifications for your test results.

## Features

- ğŸ“§ Automatic email notifications after test runs
- ğŸ“Š Test summary with pass/fail counts and pass rate
- ğŸ”— Direct link to full Allure report on GitHub Pages
- âœ… Beautiful HTML email with test statistics
- âŒ List of failed tests in email
- ğŸ¤– Works with Gmail, Outlook, and other SMTP servers

## Setup Steps

### 1. Configure Email Credentials

Copy the example environment file and fill in your details:

```bash
cp .env.example .env
```

Edit `.env` file with your email settings:

```env
# SMTP Server Configuration
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false

# Email Credentials
EMAIL_USER=your-email@gmail.com
EMAIL_PASSWORD=your-app-password-here

# Recipients (comma-separated for multiple)
EMAIL_RECIPIENTS=recipient1@email.com,recipient2@email.com
```

### 2. Gmail Setup (Recommended)

If using Gmail, you need to generate an App Password:

1. **Enable 2-Factor Authentication** on your Google account
2. Go to Google Account â†’ Security â†’ 2-Step Verification
3. At the bottom, click **App passwords**
4. Select app: **Mail**
5. Select device: **Other (Custom name)** â†’ Enter "Playwright Tests"
6. Click **Generate**
7. Copy the 16-character password
8. Use this password in your `.env` file as `EMAIL_PASSWORD`

**Guide:** https://support.google.com/accounts/answer/185833

### 3. Other Email Providers

**Outlook/Office 365:**
```env
SMTP_HOST=smtp.office365.com
SMTP_PORT=587
SMTP_SECURE=false
EMAIL_USER=your-email@outlook.com
EMAIL_PASSWORD=your-password
```

**Yahoo Mail:**
```env
SMTP_HOST=smtp.mail.yahoo.com
SMTP_PORT=587
SMTP_SECURE=false
EMAIL_USER=your-email@yahoo.com
EMAIL_PASSWORD=your-app-password
```

**Custom SMTP Server:**
```env
SMTP_HOST=smtp.yourcompany.com
SMTP_PORT=587
SMTP_SECURE=false
EMAIL_USER=your-email@company.com
EMAIL_PASSWORD=your-password
```

## Usage

### Run Tests and Send Email

**All tests with email:**
```bash
npm run test:chromium:email
```

**E2E tests only with email:**
```bash
npm run test:e2e:chromium:email
```

**Just send email for existing results:**
```bash
npm run email:report
```

### Command Options

| Command | Tests Run | Actions |
|---------|-----------|---------|
| `test:chromium:email` | All tests | Run â†’ Publish â†’ Email |
| `test:e2e:chromium:email` | E2E tests only | Run â†’ Publish â†’ Email |
| `email:report` | None | Send email for existing results |

## Email Content

The email includes:

### Summary Section:
- Total tests run
- Passed tests (green)
- Failed tests (red)
- Skipped tests
- Pass rate percentage

### Failed Tests Section:
- List of all failed test names (if any)
- Appears only when tests fail

### Action Button:
- **"View Full Report"** button linking to GitHub Pages

### Footer:
- Report URL
- Timestamp

## Example Email

```
Subject: âœ… Test Report - 95.00% Pass Rate (19/20 passed)

[Beautiful HTML email with:]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   Test Execution Report
   2/5/2026, 5:30:00 PM
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Test Results Summary
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  20        19        1         0
  Total     Passed    Failed    Skipped

Pass Rate: 95%

[View Full Report Button]

ğŸ¤– Generated by Playwright Test Automation
```

## Troubleshooting

### Authentication Error

If you get "Authentication failed":

**Gmail:**
- Make sure 2FA is enabled
- Use App Password, not regular password
- Check App Password is entered correctly (no spaces)

**Other providers:**
- Check username/password are correct
- Check SMTP host and port are correct
- Some providers require "Less secure app access" to be enabled

### Email Not Sending

Check:
1. âœ… `.env` file exists and has correct values
2. âœ… `EMAIL_USER` and `EMAIL_PASSWORD` are set
3. âœ… Internet connection is working
4. âœ… SMTP host and port are correct for your provider
5. âœ… Firewall isn't blocking SMTP port

### No Environment Variables

Make sure to run tests from the project root directory where `.env` file exists.

## Multiple Recipients

Send to multiple people by separating emails with commas:

```env
EMAIL_RECIPIENTS=dev1@company.com,dev2@company.com,manager@company.com
```

## Scheduling (Optional)

### Windows Task Scheduler

1. Create a batch file `run-tests-and-email.bat`:
```batch
cd C:\Users\Rodrigo.Topete\Documents\PMtest
npm run test:e2e:chromium:email
```

2. Open Task Scheduler
3. Create new task
4. Set schedule (e.g., daily at 9 AM)
5. Action: Run batch file

### Linux/Mac Cron

Add to crontab:
```bash
0 9 * * * cd /path/to/PMtest && npm run test:e2e:chromium:email
```

## Security Notes

- âš ï¸ Never commit `.env` file to git (already in .gitignore)
- âš ï¸ Use App Passwords, not regular passwords
- âš ï¸ Only share credentials with authorized team members
- âœ… `.env` file is already in `.gitignore` for safety

## Customization

To customize the email content, edit:
```
scripts/send-email-report.js
```

You can modify:
- Email subject format
- HTML template
- Statistics displayed
- Report URL
- Email sender name

## Support

If you encounter issues:
1. Check your `.env` file configuration
2. Test with a simple email first: `npm run email:report`
3. Check console output for error messages
4. Verify SMTP credentials with your email provider
